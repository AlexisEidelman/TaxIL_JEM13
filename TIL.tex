\epigraph{\textit{C'est comme aux échec : d'abord on place ses pièces, et ensuite, on lance l'attaque}}{Le cinquième élément \\ \textsc{Luc Besson}}

Cet épigraphe est là pour rappeler que le projet \til~est encore très jeune. Dans une phase de développement, les résultats obtenus ont pour l'instant comme principal voire unique mérite d'être produits par le modèle. Il s'agit pour l'instant plus d'une réalisation technique et donc un peu frustrante. La phase de production de résultats ne devrait toutefois pas tarder. \\

Avant de commencer cette partie, certaines personnes doivent être remerciées. En effet, le projet \til \ a bénéficié de l'aide de plusieurs autres projets. Le souci de partage des personnes concernées, leur réceptivité aux idées d'amélioration ainsi que leurs conseils et leurs temps ont été d'une aide extrêmement précieuse. \til~n'est pas encore un sujet abouti mais il serait très éloigné de ce qu'il est en matière et auraient probablement des objectifs beaucoup plus restreint sans elles. Je remercie donc l'équipe d'OpenFisca\footnote{\url{http://www.openfisca.fr/} } et en particulier M. Ben Jelloul, l'équipe de Liam2\footnote{\url{ http://liam2.plan.be/}} en en particulier G. Dekkers et G. de Menten, l'équipe Destinie de l'Insee avec Aude Leduc et Anthony Marino et l'équipe de PensIPP \footnote{\url{http://www.ipp.eu/fr/outils/pensipp-simulation/}} et en particulier D. Blanchet et S.Rabaté.

\subsection{Quelques mots de technique}

Dans cette courte section, seront décrits les choix techniques faits pour réaliser la simulation. Nous verrons que la question de la performance ne doit pas être négligée. Appliquer la législation socio-fiscale d'une année prend plus de 15 minutes lorsqu'elle est codée en SAS par exemple. Dans un calcul sur l'ensemble du cycle de vie, cette législation doit être simulée disons cent fois, l'optimisation du temps de calcul peut donc avoir du bon pour ne pas prendre 25 heures de calcul. Cela d'autant plus que la volonté de travailler sur un gros échantillon peut augmenter considérablement le temps de calcul, et que l'on a l'idée un jour d'introduire de la décision comportementale des agents en fonction de leur espérance de gain actualisée, et donc de simuler la législation bien plus de cent fois.

\subsubsection{La base de données initiales}

Comme on peut l'imaginer à la lecture de la première partie de ce document c'est l'enquête Patrimoine qui va servir de base d'information à notre modèle. La raison en est la connaissance des trajectoires professionnelle passée. La connaissance du patrimoine est aussi , bien sûr, une des forces de l'enquête. On aurait pu utiliser d'autres sources. Par exemple l'enquête Santé et Itinéraire Professionnel, qui comme son nom là aussi l'indique, est bien moins précise sur le patrimoine mais bien plus sur les conditions de santé. Pour la simulation du futur uniquement, on peut aussi envisager l'utilisation d'enquêtes plus générales et n'ayant pas de volet trajectoire. Ainsi, l'enquête Budget des Familles est par exemple attirante car la consommation est alors connue, au moins pour une année. On peut aussi penser à l'enquête Logement.
L'idée est à étudier mais on peut essayer d'étendre le matching statistique réalisé avec deux enquêtes à plusieurs en constituant ce faisant une sur-enquête couvrant la majorité des champs micro-économiques.

Dans la suite, nous ne parlerons que de l'enquête Patrimoine 2009-2010. L'échantillon contient 29 951 individus répartis en 12788 ménages\footnote{Les ménages interrogés aux Antilles, ont un questionnaire légèrement différent. Par souci de simplicité et pour travailler avec un échantillon uniforme, ils sont pour l'instant exclus du champ.}. De plus, 14 954 déclarations fiscales sont imputées (pour l'instant sommairement).

\subsubsection{La fermeture de l'échantillon}

Une première limite de l'enquête Patrimoine pour notre sujet est qu'elle ne donne pas de lien entre les ménages. Si les relations sont connues au sein d'un ménage, on veut aussi connaître les relations et particulièrement les liens de filiation entre les individus qui ne vivent pas dans le même ménage. Cela peut permettre d'imputer ensuite les successions, les pensions alimentaires l'aide pendant les études mais aussi les différentes formes d'aide vers les ascendants, en particulier en cas de dépendance. On peut aussi imaginer d'imputer un recours aux grands parents pour les gardes d'enfants. \\

Dans l'enquête patrimoine, les parents ayant des enfants vivant à l'extérieur du domicile se voient poser quelques questions à leur sujet (date de naissance, nombre d'enfant, statut sur le marché de l'emploi, diplôme, etc.). Nous créons ainsi des individus factices représentant ces enfants hors domicile. Puis par un procédé de matching, nous cherchons des individus correspondants, déclarant un ou deux parents en vie, qui correspondent le plus possible à ces statistiques. On attribue alors les parents enquêtés à l'individu fictif comme étant ses parents

Nous n'utilisons pas les informations ascendantes, celles que les enfants déclarent à propos de leur parents. Elles sont assez pauvres et concernent pratiquement exclusivement l'enfance de l'enfant or il se peut que la situation des parents ait changé entre l'enfance de l'enfant et le moment de l'enquête. On pourrait aussi utiliser les informations sur le décès ou non des grands-parents. Enfin, notons que nous n'utilisons que les données de l'enquête, on n'utilise pas d'information annexe par exemple sur la corrélation entre les revenus des parents et des enfants. Pour l'instant, on fait donc l'hypothèse que les variables utilisées sont suffisantes pour que les distributions croisées soient respectées. \\

Nous donnons ici une précision sur la méthode de calcul pour souligner au lecteur une petite limite actuelle de cette étape. Lorsque les parents sont interrogés sur leurs enfants vivant hors du domicile, on leur demande de préciser s'il s'agit de l'enfant du couple ou de l'un d'eux seulement. S'il s'agit de l'enfant du couple, alors on cherche des enfants dont les deux parents sont vivants. Il reste ensuite de tels enfants avec deux parents vivants à apparier ce qui est logique car les parents peuvent être vivants et ne plus vivre ensemble. On cherche pour eux, comme pour les enfants n'ayant qu'un parent à trouver, un père puis une mère. Si on ne cherche qu'un parent, il n'y a pas de problème. En revanche, un point à noter est que lorsque l'on cherche deux parents, on les cherche indépendamment. Par exemple, si on a deux enfants identiques, deux pères potentiels, l'un de 40 et l'autre de 60 ans et deux mères potentielles, l'une de 40 ans et l'autre de 60 ans, rien ne contrôle que l'on a plus de chance d'avoir un couple dont les deux membres ont 40 ans et un dont les deux couples ont 60 ans que deux couples avec 20 ans d'écart d'âge. On peut donc ne pas reproduire la réalité statistique en créant une distribution jointe des parents non réaliste. Du moins c'est le cas, si on pense que deux couples de parents peuvent avoir des enfants similaires même s'ils sont différents au départ. Une solution serait, une fois la mère trouvée, de chercher un père avec un âge assez proche, une autre solution serait de réaliser un mariage fictif des parents ayant des enfants similaires puis de tirer un couple de parents pour les enfants. \\

Enfin, précisons que le matching est fait à partir d'une méthode de score (voir Annexe pour plus d'information sur les méthodes de matching)

\subsubsection{Étendre l'échantillon}

Travailler avec des pondérations n'est en général pas un problème dans le cadre de statistiques statiques. Cependant, dans le contexte particulier de la microsimulation dynamique où des liens sont établis entre ménages cela pose problème. On ne peut en effet pas associer 50 enfants à 3 000 mères ou unir un homme en représentant 1000 avec une femme représentant 2000 femmes de la population française. On se demande par exemple, comment on pondérerait leurs enfants. Pour solutionner le problème, le choix a été fait de dupliquer les individus autant de fois que nécessaire pour ainsi avoir une pondération uniforme. Dans l'enquête Patrimoine 2010, qui contient un sur-échantillonnage des hauts patrimoines, la plus petite pondération est de 6 et cela devrait être la pondération uniforme. Cela nous mène en théorie à une base de plus de 10 millions de lignes dans la base pour représenter la population française. \\

Le modèle DESTINIE tire ensuite un sous-échantillon à partir de cette population étendue. \til , quant à lui, essaie de tourner sur l'ensemble de cet échantillon. Cela a aussi l'avantage qu'un même individu au départ se verra associé à plusieurs carrières. On conserve ainsi une certaine variabilité dans le futur de chaque individu de la base initiale ce qui ne peut être que bon pour la précision statistique. Comme nous le verrons ci-dessous, travailler sur une base étendue est un vrai challenge. Pour l'instant, nous travaillons en général sur l'échantillon non étendu, sans tenir compte des pondérations dans les différentes étapes. Une alternative acceptable en termes de temps de calcul et qui permet de tester le modèle est d'utiliser comme pondération uniforme 200, ce qui fait une base de 300 000 individus. Les ménages avec une pondération initiale inférieure à 200 se voient attribuer un poids de 200, ce qui biaise donc en théorie pour l'instant un peu les résultats.

\subsubsection{Choix de langage de programmation}

Toutes les étapes initiales, y compris l'extension de l'échantillon décrit ci-dessus, sont réalisées en R. Les étapes de simulation, vieillissement de la population et calcul de la législation sont réalisées en Python. On utilise ainsi les forces de chaque programme\footnote{Parce qu'il s'agit d'un matching, l'étape de création des liens entre parents et enfants vivant hors domicile est, elle aussi, réalisée en Python.}. L'utilisation de Python permet une écriture adaptée à la microsimulation et est relativement incomparable avec les logiciels statistiques en termes de performances dont on a montré qu'elles étaient importantes pour \til .
L'étape de calcul de la législation qui prend 15 minutes en SAS est effectué dans un temps de l'ordre de grandeur de dix secondes. La possibilité de travailler avec un gros échantillon ou avec des équations comportementales devient envisageable.

\subsection{Les étapes de la simulation dynamique}

Avant d'entamer cette section, il faut préciser que \til \ est encore un projet jeune en développement. Les étapes présentées ici peuvent toutes être améliorées, certaines sont tellement rudimentaires qu'elles n'ont d'autre mérite que d'exister. La description de ces étapes permet toutefois de donner une première idée des fonctionnalités et possibilités de \til . L'écriture sous forme de modules indépendants permet à tout moment d'améliorer chacune de ces étapes.

\subsubsection{Démographie}

L'âge est bien sûr incrémenté à chaque période.

\paragraph{Naissance}. Toutes les femmes en couple âgées de 16 à 50 ans se voient imputer un enfant\footnote{On élimine les femmes qui ont 8 enfants ou plus ou dont le conjoint est dans cette situation.
On pourrait toutefois supprimer sans difficulté cette condition.}.
Un certain nombre de ces femmes est sélectionné en s'assurant de vérifier les projections de naissance en fonction de l'âge de la mère. Le sexe de l'enfant est choisi aléatoirement.

Le fait de ne pas avoir de probabilité différente pour les femmes selon leurs caractéristiques autre que leur âge est problématique. Le nombre d'enfants ainsi que le niveau d'études devrait intervenir\footnote{On ne peut pas pour autant dire que le tirage obtenu et complétement indépendant du niveau d'études et du nombre d'enfants dans la mesure où ceux-ci interviennent dans les équations de mise en couple et de divorce, pré-requis pour se voir imputer des enfants dans \til.}.

\paragraph{Décès}. La probabilité de décès ne dépend que de l'âge et du sexe. Le nombre de décès prédit par les projections démographiques de l'Insee est ainsi reproduit. Si une personne décédée vit seule avec des enfants, ces enfants sont attribués à l'autre parent si celui-ci est encore en vie. Si ce n'est pas le cas, ils sont affectés à un ménage spécial sans adulte avec tous les autres enfants dans ce cas.

\paragraph{Union}. Pour l'instant, dans le modèle, l'union entre deux personnes correspond à la fois à un emménagement et à une union légale. Sans qu'il n'y ait de contre-indication technique à le faire, il n'y a donc pas de création de concubinage. Il en existe toutefois dans la base initiale.
Reprenant les équations utilisée par DESTINIE à partir du travail de Duée(??) on impute une probabilité d'avoir se mettre en couple. Cela est fait d'une part pour les premières unions et d'autre part pour les personnes ayant déjà été en couple séparément selon le sexe, en fonction de l'âge depuis la fin des études, du fait d'avoir un enfant, et de la durée depuis la précédente séparation le cas échéant. En utilsant une méthode d'alignement de Liam2 (voir ... ), un tiers de ces personnes est sélectionné\footnote{Un calage plus pertinent ne serait pas une mauvaise chose.}. Ensuite, un matching est effectué pour associer les individus en fonction de leur âge, de leur différence d'âge et de leur niveau de diplôme comparé. Encore une fois, ce matching, crucial pour étudier bon nombre de questions de redistribution, par exemple, l'impact de l'endogamie, mériterait d'être affiné.
En cas d'union, les personnes rattachées aux nouveaux conjoints (enfants le plus souvent) emménage avec eux. Idem pour les déclarations fiscales.

\paragraph{Séparation}. C'est plus crédible cette fois : les séparations se traduisent à la fois par un changement de logement d'un des deux conjoints et par une rupture du contrat (et donc le passage à des déclarations fiscales séparées). La probabilité de rupture dépend du nombre d'enfant du couple, de son ancienneté et de la différence d'âge entre ses membres. Ceci pourrait être régi par des probabilités mais pour l'instant c'est l'homme qui déménage (sauf lorsque le couple habitait chez ses parents) et la femme qui a une nouvelle déclaration\footnote{Dans le cas de couple homosexuel, le choix est fait aléatoirement}. Les enfants et personnes rattachées ne changent de logement que s'ils sont liés à la personne qui part sans être liés à la personne qui reste, que ce soit pour le logement ou pour la déclaration fiscale.

\subsubsection{Logement}
Le travail sur le logement est extrêmement rudimentaire. Les déménagement ne se font que lors des unions et séparations et lorsqu'une personne de plus de 24 ans n'est ni personne de référence ni en couple (i.e. vit avec ses parents).
Le travail sur les loyers n'a pas encore été fait mais ne devrait pas poser de difficulté majeure.

On pourrait à terme utiliser réellement un parc de logement dont on simulerait la variation chaque année. Lors des déménagements, les ménages choisiraient l'un des logements en fonction de la taille du ménage et du logement ainsi qu'en fonction des revenus et du loyer. On simulerait ainsi des déménagements en fonction d'un surpeuplement ou sous-peuplement ainsi qu'en cas d'évolution dans les revenus. L'idée serait de reproduire des tensions sur le marché du logement.

On impute aussi initialement pour chaque logement un propriétaire. Du travail est encore nécessaire à cette étape mais indubitablement savoir identifier les propriétaires de leur résidence, les locataires sera un plus pour le modèle.

\subsubsection{Marché du travail}

La question de la situation sur le marché de l'emploi est évidemment un élément crucial pour \til , qui veut étudier la redistribution.
C'est à ce niveau que l'investissement le plus important devra être fait. Les équations de transition devraient être estimées le plus précisément possible en tenant compte d'un nombre important de paramètres afin de reproduire la réalité du marché du travail.
On est pour l'instant loin d'un niveau satisfaisant mais il sera, là encore, facile, au moins en termes de programmation d'améliorer cette partie du modèle.

\paragraph{Éducation}. L'entrée sur le marché du travail correspond à la fin des études. L'âge de fin d'études est déterminé à partir de l'âge de fin d'études des parents (au moment de la naissance de l'enfant donc). On peut penser à des modèles plus compliqués de décision (voir \ref{comportement}). Pour l'instant, on impute pour les individus qui ne sont pas encore sortis du système scolaire un âge de fin d'études qui est la moyenne de celui de ses parents auxquels on ajoute un élément correcteur en fonction de leur date de naissance pour tenir compte de l'allongement moyen des études.

Lorsque l'individu est encore en étude, son niveau scolaire est entièrement déterminé par son âge. Ce niveau d'étude servira ensuite à imputer la valeur du transfert en nature associée à l'éducation.

\paragraph{Situation}. Dans l'idéal, on détermine l'état à la date T+1 en fonction de l'état à la date T mais aussi des états précédents pour être plus précis. Pour l'instant deux méthodes simplistes ont été implémentées. La première calcule un score en fonction de l'âge puis tire un nombre de transition en suivant des proportions en input du modèle. La seconde sélectionne aléatoirement 2,5 \% des individus actifs et inactifs pour les faire changer de statut. Au passage à l'activité, la catégorie d'emploi est tirée au sort.

\paragraph{Type d'emploi et d'employeur}. Comme pour le logement, on crée un fichier d'entreprise. Tout est à faire mais on a avec l'enquête Patrimoine une idée de la taille de l'entreprise des salariés. Une des entreprises peut regrouper les indépendants et libéraux. Cet élément n'est pas prioritaire mais l'idée est de pouvoir simuler un marché du travail par secteur ou bien d'avoir un modèle de travailleurs indépendants ou encore de se focaliser sur un secteur d'activité particulier, la médecine par exemple.

\paragraph{Salaire et revenus}. Les salaires sont pour l'instant imputés à partir d'une équation de Mincer relativement simple. Si la personne a un revenu d'activité initialement, on détermine une productivité individuelle comme étant le rapport entre son salaire et le salaire de l'équation de Mincer. Pour les autres, la productivité est tirée aléatoirement. Par la suite, l'équation de Mincer sera toujours multipliée par la productivité pour déterminer les salaires.

\paragraph{Retraite}. Le passage à la retraite est pour l'instant entièrement déterminé par l'âge.


\subsubsection{Épargne et consommation}

Les deux thèmes d'épargne et de consommation doivent toujours être pensés ensemble. En effet, à chaque période, on sait que le revenu est consommé ou épargné. Si l'un de deux éléments est déterminé, l'autre s'en déduit. Un taux d'épargne est donc simulé. Il faut ensuite déterminer la structure de consommation ainsi que la structure d'épargne. L'achat immobilier demandera une imputation particulière. \\

On se servira de l'enquête Budget des Familles, pour imputer une structure de consommation en catégorie permettant de calculer les taxes sur la consommation. \\

A partir du nouveau stock d'épargne de la période T, on détermine des revenus du patrimoine à la période T+1.

\subsubsection{Calcul de la législation}. En fin de simulation, la législation est calculée. Cela inclut les cotisations salariales, l'impôt sur le revenu, l'impôt sur la fortune, le bouclier fiscal et les prestations. Les prestations associées au handicap sont déjà simulées mais cette information n'est pas encore dans la projection de la population. Les taxes (habitation et foncière) sont encore à travailler. Tout le volet santé est aussi à travailler.

Enfin, les retraites et le chômage devrait être imputés d'ici peu.

\subsection{Projets futurs}

On a déjà donné beaucoup de pistes d'amélioration dans la section précédente. Ici, on présente les éléments qui pourront agrémenter le modèle à l'avenir.

\subsubsection{Simulation par mois}

Les modèles de microsimulation travaillent usuellement sur un base annuelle.
Pourtant la plupart des minima ainsi que les retraites sont calculées par trimestre, les prestations familiales et logement ainsi que les cotisations et contributions prélevées à la source sont calculées mois par mois. La simulation dynamique étant rapide, on peut modifier la période pour que le pas devienne le trimestre ou le mois.
L'étape de mise en couple qui est la plus longue peut éventuellement n'être simulée qu'une fois par an pour gagner encore du temps de calcul\footnote{Il s'agit là d'un abus de langage, car si on travaillait par trimestre par exemple, on aura quatre fois un quart des mariages annuels à simuler.
Comme l'algorithme de matching est non linéaire, il est plus rapide de faire tourner quatre fois sur le quart de l'échantillon qu'une fois sur l'échantillon global.
La contrepartie en est que le matching obtenu est théoriquement de moins bonne qualité puisque chaque individu n'a qu'un choix limité d'époux. Cette partie demanderait à être expertisée.}.
L'application de la législation pourrait se faire d'autant plus précisément.

\subsubsection{Transferts intergénérationnels}

Dans un premier temps, les calculs sont effectués avec une législation figée, celle de 2009. Les revenus et la population future sont aussi simulés en gardant les paramètres de 2009.
Par exemple, il n'y a pas de croissance simulée. Les revenus passés sont eux revalorisé en fonction de la hausse des revenus pour se voir appliquer la législation de 2009. Plus généralement toutes les équations pour obtenir des informations non contenues dans la base de départ sont simulées à partir des estimations les plus récentes. Pourtant, les comportements ont changé (la consommation de téléphones portables était réduite dans les années 80 par exemple) et si l'on voulait avoir une représentation fidèle de la consommation passée des individus par exemple, il faudrait en tenir compte. \\

Bien évidemment, à terme, \til \ simulera l'ensemble des législations passées et simulera la population en fonction de tendances observées ou supposées. Les imputations dépendront de la période simulée. Ceci permettra de reproduire fidèlement la population et de pouvoir procéder à une analyse d'équité intergénérationnelle. Pour l'instant, on étudie finalement une population de 2009 évoluant et ayant évolué dans les conditions de 2009 hormis pour les trajectoires salariales et matrimoniales avant 2009.

\subsubsection{Comportements}
\label{comportement}

Une dimension supplémentaire peut être apportée au modèle en introduisant des équations comportementales. Au lieu de simuler des transitions en fonction d'équations estimées, on peut créer un modèle d'agent dans lequel les individus prennent leur décision en fonction d'anticipation. Il y a deux décisions importantes dans le cycle de vie dans lesquelles ces modèles ont leur place : le choix d'éducation et la retraite.

Le choix d'éducation est le plus compliqué des deux car les anticipations rationnelle portent sur une durée plus grande et la diversité des trajectoires envisagée peut être très importante. L'idée serait, pour un individu devant décider à la période T d'entrer sur le marché du travail ou continuer ses études, de générer une évaluation de ses revenus dans les deux options et de lui faire choisir celle qui optimise son utilité (actualisée).
Ainsi, on pourrait mesurer l'influence d'une hausse de l'impôt sur le revenu, des minima sociaux ou encore des retraites sur les choix d'éducation.
Bien sûr, la carrière n'est pas entièrement déterminée par le choix d'éducation, on pourra, dans les deux options, simuler plusieurs centaines d'avenirs possibles et estimer ainsi l'espérance de l'utilité de chaque option.

\subsubsection{Autres enquêtes}

Comme on l'a dit en introduction de cette partie, le modèle pourrait aussi gagner à utiliser d'autres enquêtes. En particulier l'utilisation d'enquêtes portant sur la santé pourrait ajouter cette dimension au modèle.
